<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LankaMart - The Best Shopping Experience</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* --- CORE STYLES --- */
        :root {
            --primary-orange: #f85606;
            --primary-hover: #d04300;
            --secondary-blue: #0f1e29;
            --bg-gray: #f5f5f5;
            --white: #ffffff;
            --text-dark: #212121;
            --text-light: #757575;
            --success-green: #00bfa5;
            --border-color: #eff0f5;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Roboto', sans-serif; scroll-behavior: smooth; }
        body { background-color: var(--bg-gray); color: var(--text-dark); padding-bottom: 50px; overflow-x: hidden; }
        a { text-decoration: none; color: inherit; cursor: pointer; transition: color 0.2s; }
        ul { list-style: none; }
        button { cursor: pointer; transition: all 0.3s ease; }
        button:active { transform: scale(0.95); }

        /* --- UTILITIES --- */
        .container { max-width: 1200px; margin: 0 auto; padding: 0 15px; }
        .section-title { font-size: 22px; font-weight: 400; color: #444; margin: 20px 0 10px; position: relative; padding-left: 10px; }
        .section-title::before { content:''; position: absolute; left: 0; top: 5px; bottom: 5px; width: 4px; background: var(--primary-orange); border-radius: 2px; }
        
        /* Animations */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(248, 86, 6, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(248, 86, 6, 0); } 100% { box-shadow: 0 0 0 0 rgba(248, 86, 6, 0); } }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .fade-in { animation: fadeIn 0.5s ease forwards; }

        /* --- HEADER --- */
        .top-bar { background-color: #f5f5f5; padding: 5px 0; border-bottom: 1px solid #ddd; font-size: 12px; }
        .top-links { display: flex; justify-content: flex-end; gap: 20px; color: var(--secondary-blue); text-transform: uppercase; }
        .top-links a:hover { color: var(--primary-orange); }

        .navbar { background-color: var(--white); padding: 15px 0; position: sticky; top: 0; z-index: 1000; box-shadow: 0 2px 10px rgba(0,0,0,0.05); transition: all 0.3s; }
        .nav-content { display: flex; align-items: center; justify-content: space-between; gap: 30px; }
        
        .logo { font-size: 28px; font-weight: 700; color: var(--secondary-blue); cursor: pointer; display: flex; align-items: center; }
        .logo span { color: var(--primary-orange); }
        .logo:hover { transform: scale(1.02); }

        .search-bar { flex: 1; display: flex; background: #eff0f5; border-radius: 8px; overflow: hidden; border: 1px solid transparent; transition: 0.3s; }
        .search-bar:focus-within { border-color: var(--primary-orange); background: white; box-shadow: 0 0 5px rgba(248, 86, 6, 0.2); }
        .search-input { flex: 1; padding: 12px; border: none; background: transparent; outline: none; }
        .search-btn { background: var(--primary-orange); color: white; border: none; padding: 0 25px; font-size: 18px; }
        .search-btn:hover { background: var(--primary-hover); }

        .nav-icons { display: flex; gap: 20px; font-size: 22px; color: var(--secondary-blue); align-items: center; }
        .nav-icons i { transition: 0.2s; cursor: pointer; }
        .nav-icons i:hover { color: var(--primary-orange); transform: translateY(-2px); }
        .cart-icon-wrap { position: relative; cursor: pointer; }
        .cart-count { position: absolute; top: -8px; right: -8px; background: var(--primary-orange); color: white; font-size: 10px; padding: 2px 6px; border-radius: 50%; font-weight: bold; animation: bounce 0.5s; }

        /* --- VIEWS MANAGEMENT --- */
        #productDetailView { display: none; opacity: 0; transition: opacity 0.4s; }
        #homeView { transition: opacity 0.4s; }

        /* --- HERO & CATEGORIES --- */
        .hero-banner { 
            background: linear-gradient(135deg, #f85606, #ff9e66); 
            height: 320px; border-radius: 10px; margin: 20px 0; 
            display: flex; align-items: center; justify-content: center; color: white;
            text-align: center;
            position: relative; overflow: hidden;
            box-shadow: 0 10px 20px rgba(248, 86, 6, 0.2);
        }
        .hero-banner::after {
            content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: url('https://images.unsplash.com/photo-1607082348824-0a96f2a4b9da?w=1200&q=80') center/cover;
            opacity: 0.15;
            transition: transform 10s linear;
        }
        .hero-banner:hover::after { transform: scale(1.1); }
        .hero-content { position: relative; z-index: 1; animation: fadeIn 0.8s ease-out; }
        .hero-banner h1 { font-size: 46px; margin-bottom: 15px; text-shadow: 0 4px 8px rgba(0,0,0,0.2); font-weight: 800; letter-spacing: -1px; }
        .hero-banner button { padding: 14px 30px; border: none; background: white; color: var(--primary-orange); font-weight: bold; border-radius: 30px; margin-top: 20px; transition: all 0.3s; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .hero-banner button:hover { transform: translateY(-3px) scale(1.05); box-shadow: 0 8px 20px rgba(0,0,0,0.3); }

        .categories { display: flex; justify-content: space-between; background: white; padding: 25px; border-radius: 12px; margin-bottom: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.03); }
        .cat-item { display: flex; flex-direction: column; align-items: center; min-width: 80px; gap: 12px; font-size: 13px; cursor: pointer; color: #555; transition: 0.3s; }
        .cat-icon { width: 55px; height: 55px; border-radius: 50%; border: 1px solid #eee; display: flex; align-items: center; justify-content: center; font-size: 22px; color: var(--text-dark); transition: 0.3s; background: #f9f9f9; position: relative; overflow: hidden; }
        .cat-item:hover .cat-icon { background: var(--primary-orange); color: white; border-color: var(--primary-orange); transform: translateY(-5px) rotate(5deg); box-shadow: 0 5px 15px rgba(248, 86, 6, 0.3); }
        .cat-item:hover { color: var(--primary-orange); font-weight: 500; }

        /* --- FLASH SALE --- */
        .flash-sale-container { background: white; padding: 20px; border-radius: 12px; margin-bottom: 25px; border: 1px solid #ffece5; }
        .flash-header { display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid #eee; padding-bottom: 15px; margin-bottom: 15px; }
        .flash-title { color: var(--primary-orange); font-size: 22px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; }
        .timer-box { display: flex; gap: 8px; align-items: center; font-weight: 500; }
        .timer-block { background: var(--primary-orange); color: white; padding: 6px 10px; border-radius: 4px; font-weight: bold; font-size: 15px; min-width: 35px; text-align: center; }
        .flash-grid { display: flex; gap: 15px; overflow-x: auto; padding-bottom: 15px; scrollbar-width: thin; scroll-behavior: smooth; }
        .flash-grid::-webkit-scrollbar { height: 6px; }
        .flash-grid::-webkit-scrollbar-thumb { background: #ffccbc; border-radius: 3px; }
        .flash-grid::-webkit-scrollbar-thumb:hover { background: var(--primary-orange); }
        
        /* --- PRODUCTS GRID --- */
        .products-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(190px, 1fr)); gap: 20px; margin-top: 20px; }
        
        /* Product Card */
        .card { background: white; border-radius: 10px; overflow: hidden; cursor: pointer; transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); height: 100%; display: flex; flex-direction: column; border: 1px solid transparent; position: relative; }
        .card:hover { transform: translateY(-8px); box-shadow: 0 15px 30px rgba(0,0,0,0.1); border-color: #eee; z-index: 2; }
        .card-img-wrap { padding-top: 100%; position: relative; background: #f9f9f9; overflow: hidden; }
        .card-img { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; transition: transform 0.5s ease; }
        .card:hover .card-img { transform: scale(1.1); }
        .card-info { padding: 15px; display: flex; flex-direction: column; flex-grow: 1; }
        .card-title { font-size: 14px; margin-bottom: 8px; line-height: 1.4; height: 40px; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; color: #333; transition: color 0.2s; }
        .card:hover .card-title { color: var(--primary-orange); }
        .card-price { color: var(--primary-orange); font-size: 18px; font-weight: 700; margin-top: auto; display: flex; align-items: center; gap: 5px; }
        .card-old-price { font-size: 12px; color: var(--text-light); text-decoration: line-through; font-weight: 400; }
        .rating-wrap { display: flex; align-items: center; gap: 5px; margin-top: 8px; font-size: 11px; color: #aaa; }
        .stars { color: #faca51; }
        .sale-badge { position: absolute; top: 8px; left: 8px; background: var(--primary-orange); color: white; padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: 700; box-shadow: 0 2px 6px rgba(248,86,6,0.3); }
        .heart-btn { position: absolute; top: 8px; right: 8px; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; background: rgba(255,255,255,0.85); border-radius: 50%; color: #e53935; font-size: 16px; transition: 0.2s; }
        .heart-btn:hover { transform: scale(1.1); background: white; }

        /* --- SPIN WHEEL --- */
        .spin-btn-float { position: fixed; bottom: 30px; right: 30px; width: auto; padding: 0 20px; height: 60px; background: linear-gradient(45deg, #FFC107, #FF9800); border-radius: 30px; display: flex; align-items: center; gap: 10px; font-size: 24px; color: white; cursor: pointer; box-shadow: 0 5px 20px rgba(255, 152, 0, 0.4); z-index: 1500; animation: pulse 2s infinite; transition: 0.3s; }
        .spin-btn-float:hover { transform: scale(1.05); }
        .spin-text { font-size: 16px; font-weight: bold; text-transform: uppercase; }

        .wheel-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2100; display: none; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        .wheel-container { position: relative; width: 350px; height: 350px; border-radius: 50%; border: 10px solid white; overflow: hidden; box-shadow: 0 0 50px rgba(255,255,255,0.2); transition: transform 4s cubic-bezier(0.2, 0.8, 0.3, 1); background: #fff; }
        .wheel-segment { position: absolute; width: 50%; height: 50%; transform-origin: 100% 100%; clip-path: polygon(0 0, 100% 0, 100% 100%); display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 14px; color: white; }
        .wheel-segment span { transform: rotate(0deg); display:block; }
        .wheel-pointer { position: absolute; top: -15px; left: 50%; transform: translateX(-50%); width: 30px; height: 40px; background: red; clip-path: polygon(50% 100%, 0 0, 100% 0); z-index: 2200; }
        .spin-center-btn { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 70px; height: 70px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; cursor: pointer; z-index: 2200; border: 4px solid var(--primary-orange); color: var(--primary-orange); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        
        /* --- PRODUCT DETAIL VIEW --- */
        .breadcrumb { margin: 15px 0; font-size: 13px; color: var(--text-light); }
        .breadcrumb span { cursor: pointer; color: var(--secondary-blue); transition: 0.2s; }
        .breadcrumb span:hover { text-decoration: underline; color: var(--primary-orange); }

        .detail-container { background: white; padding: 30px; border-radius: 12px; display: flex; gap: 40px; flex-wrap: wrap; margin-bottom: 20px; box-shadow: 0 5px 20px rgba(0,0,0,0.05); }
        
        .detail-gallery { flex: 1; min-width: 350px; position: relative; overflow: hidden; border-radius: 8px; }
        .main-image { width: 100%; height: 450px; object-fit: contain; border-radius: 8px; border: 1px solid #eee; background: #fff; transition: transform 0.3s; cursor: zoom-in; }
        .main-image:hover { transform: scale(1.5); }
        
        .detail-info { flex: 1.5; min-width: 350px; }
        .detail-title { font-size: 28px; font-weight: 500; margin-bottom: 10px; color: #222; }
        .detail-rating { color: #faca51; font-size: 14px; margin-bottom: 20px; display: flex; align-items: center; }
        .detail-price-box { background: #fafafa; padding: 20px; border-radius: 8px; margin-bottom: 25px; border-left: 5px solid var(--primary-orange); }
        .detail-price { font-size: 38px; color: var(--primary-orange); font-weight: 700; }
        .detail-old-price { color: #999; text-decoration: line-through; margin-right: 10px; font-size: 16px; }
        .detail-discount { color: white; background: var(--primary-orange); padding: 2px 8px; border-radius: 4px; font-weight: bold; font-size: 14px; }
        
        .detail-actions { margin-top: 30px; display: flex; gap: 20px; }
        .btn-buy { flex: 1; background: linear-gradient(to right, #f85606, #ff7e3d); color: white; border: none; padding: 15px; font-size: 18px; border-radius: 6px; font-weight: 600; transition: 0.3s; box-shadow: 0 4px 15px rgba(248, 86, 6, 0.3); }
        .btn-add { flex: 1; background: #2aabb6; color: white; border: none; padding: 15px; font-size: 18px; border-radius: 6px; font-weight: 600; transition: 0.3s; box-shadow: 0 4px 15px rgba(42, 187, 182, 0.3); }
        .btn-buy:hover, .btn-add:hover { transform: translateY(-3px); opacity: 0.95; box-shadow: 0 8px 20px rgba(0,0,0,0.2); }

        .features-list { margin-top: 25px; font-size: 14px; color: #555; line-height: 1.8; }
        .features-list li { margin-bottom: 10px; display: flex; align-items: center; gap: 12px; }
        .features-list i { color: var(--success-green); font-size: 16px; background: #e0f2f1; padding: 5px; border-radius: 50%; }

        .product-desc { margin-top: 40px; border-top: 1px solid #eee; padding-top: 30px; }
        .product-desc h3 { font-size: 20px; margin-bottom: 15px; color: #333; }
        .product-desc p { font-size: 15px; color: #666; line-height: 1.7; margin-bottom: 15px; }

        /* --- CONTACT & FOOTER --- */
        .contact-section { background: white; padding: 40px; border-radius: 12px; margin: 30px 0; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 30px; box-shadow: 0 5px 20px rgba(0,0,0,0.05); border-top: 4px solid var(--secondary-blue); }
        .contact-info h3 { font-size: 24px; margin-bottom: 15px; color: var(--secondary-blue); }
        .contact-email { color: var(--primary-orange); font-weight: bold; font-size: 18px; position: relative; display: inline-block; }
        .contact-email::after { content: ''; position: absolute; bottom: -2px; left: 0; width: 0; height: 2px; background: var(--primary-orange); transition: 0.3s; }
        .contact-email:hover::after { width: 100%; }

        /* --- MODALS --- */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); display: none; align-items: center; justify-content: center; z-index: 2000; backdrop-filter: blur(5px); }
        .modal { background: white; padding: 40px; border-radius: 16px; width: 90%; max-width: 480px; box-shadow: 0 20px 50px rgba(0,0,0,0.3); animation: slideUp 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); position: relative; }
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .modal-close { position: absolute; top: 20px; right: 20px; font-size: 24px; cursor: pointer; color: #999; transition: 0.2s; }
        .modal-close:hover { color: var(--primary-orange); transform: rotate(90deg); }
        .modal h2 { margin-bottom: 25px; color: var(--secondary-blue); text-align: center; font-size: 24px; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-size: 14px; color: #555; font-weight: 500; }
        .form-control { width: 100%; padding: 14px; border: 1px solid #ddd; border-radius: 8px; font-size: 15px; transition: all 0.3s; background: #f9f9f9; }
        .form-control:focus { border-color: var(--primary-orange); outline: none; background: white; box-shadow: 0 0 0 4px rgba(248, 86, 6, 0.1); }
        .btn-block { width: 100%; padding: 14px; background: var(--primary-orange); color: white; border: none; border-radius: 8px; font-weight: bold; font-size: 16px; margin-top: 10px; box-shadow: 0 4px 15px rgba(248, 86, 6, 0.3); }
        .btn-block:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(248, 86, 6, 0.4); }
        
        .google-btn { width: 100%; padding: 12px; background: white; border: 1px solid #ddd; border-radius: 8px; display: flex; align-items: center; justify-content: center; gap: 10px; margin-top: 15px; font-weight: 500; color: #555; transition: 0.2s; }
        .google-btn:hover { background: #f1f1f1; border-color: #ccc; }

        /* Notification Toast */
        .toast { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%) translateY(50px); background: #323232; color: white; padding: 15px 30px; border-radius: 30px; opacity: 0; transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); pointer-events: none; z-index: 2000; box-shadow: 0 10px 30px rgba(0,0,0,0.3); display: flex; align-items: center; gap: 10px; font-weight: 500; }
        .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
        .toast i { color: var(--success-green); }

        /* --- DARK MODE --- */
        body.dark-mode { background-color: #121212; color: #e0e0e0; }
        body.dark-mode .navbar, body.dark-mode .categories, body.dark-mode .card, body.dark-mode .detail-container, body.dark-mode .contact-section, body.dark-mode .flash-sale-container, body.dark-mode .cart-sidebar { background-color: #1e1e1e; color: #e0e0e0; border-color: #333; }
        body.dark-mode .search-bar { background-color: #333; }
        body.dark-mode .search-input { color: white; }
        body.dark-mode .section-title { color: #f5f5f5; }
        body.dark-mode .cat-icon { background: #333; border-color: #444; color: #ccc; }
        body.dark-mode .card-title { color: #ddd; }
        body.dark-mode .detail-title { color: #fff; }
        body.dark-mode .detail-price-box { background: #252525; }
        body.dark-mode .product-desc h3, body.dark-mode .product-desc p, body.dark-mode .contact-info h3 { color: #ddd; }
        body.dark-mode .features-list i { background: #333; }
        body.dark-mode .cart-item-row { background: #2a2a2a; }

        /* --- CART SIDEBAR --- */
        .cart-sidebar {
            position: fixed; right: 0; top: 0; height: 100%; width: 350px;
            background: white; z-index: 2500; padding: 20px;
            display: flex; flex-direction: column;
            box-shadow: -5px 0 30px rgba(0,0,0,0.2);
            animation: slideInRight 0.3s ease-out;
        }
        @keyframes slideInRight { from { transform: translateX(100%); } to { transform: translateX(0); } }
        .cart-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; padding-bottom: 15px; margin-bottom: 15px; }
        .cart-items-container { flex: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; }
        .cart-item-row { display: flex; gap: 10px; align-items: center; background: #f9f9f9; padding: 10px; border-radius: 8px; }
        .cart-item-img { width: 50px; height: 50px; object-fit: cover; border-radius: 4px; }
        .cart-item-info { flex: 1; font-size: 13px; }
        .cart-item-title { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 150px; font-weight: 500; margin-bottom: 4px; }
        .cart-footer { border-top: 1px solid #eee; padding-top: 15px; margin-top: 15px; }
        .cart-total-row { display: flex; justify-content: space-between; font-size: 18px; font-weight: bold; margin-bottom: 15px; }

        /* --- WHEEL LABELS --- */
        .wheel-label {
            position: absolute; top: 50%; left: 50%;
            transform-origin: 0 0;
            text-align: right;
            width: 50%;
            padding-right: 40px;
            box-sizing: border-box;
            font-size: 14px; font-weight: bold; color: white;
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
            pointer-events: none;
        }

        @media (max-width: 768px) {
            .nav-content { flex-direction: column; gap: 15px; }
            .search-bar { width: 100%; }
            .top-links { display: none; }
            .detail-container { flex-direction: column; padding: 20px; }
            .main-image { height: 300px; }
            .contact-section { flex-direction: column; text-align: center; }
            .hero-banner { height: 250px; }
            .hero-banner h1 { font-size: 32px; }
            .spin-btn-float { bottom: 20px; right: 20px; width: 50px; height: 50px; font-size: 20px; }
        }
    </style>
</head>
<body>

    <div class="top-bar">
        <div class="container top-links">
            <a onclick="alert('App download link sent!')">Save More on App</a>
            <a onclick="alert('Redirecting to Seller Center...')">Sell on LankaMart</a>
            <a onclick="document.querySelector('.contact-section').scrollIntoView({behavior: 'smooth'})">Customer Care</a>
            <a onclick="showLogin()">Login</a>
            <a onclick="showLogin()">Sign Up</a>
        </div>
    </div>

    <nav class="navbar">
        <div class="container nav-content">
            <div class="logo" onclick="goHome()">Lanka<span>Mart</span></div>
            <div class="search-bar">
                <input type="text" id="searchInput" class="search-input" placeholder="Search in LankaMart..." onkeyup="handleSearch(event)">
                <button class="search-btn" onclick="filterProducts()"><i class="fa-solid fa-magnifying-glass"></i></button>
            </div>
            <div class="nav-icons">
                <i class="fa-solid fa-moon" onclick="toggleDarkMode()" title="Toggle Dark Mode" style="cursor:pointer; margin-right:15px;"></i>
                <i class="fa-regular fa-user" onclick="showLogin()" title="Profile"></i>
                <div class="cart-icon-wrap" onclick="openCart()">
                    <i class="fa-solid fa-cart-shopping"></i>
                    <span class="cart-count" id="cartCount">0</span>
                </div>
            </div>
        </div>
    </nav>

    <div id="toast" class="toast"><i class="fa-solid fa-check-circle"></i> <span>Item added to cart!</span></div>

    <!-- Spin Wheel Button -->
    <div class="spin-btn-float" onclick="openWheel()">
        <i class="fa-solid fa-gift"></i>
        <span class="spin-text">Spin & Win</span>
    </div>

    <!-- Wheel Modal -->
    <div id="wheelModal" class="wheel-modal" onclick="closeWheel(event)">
        <div class="wheel-container" id="wheel">
            <!-- Segments injected via JS -->
            <div class="wheel-pointer"></div>
            <div class="spin-center-btn" onclick="spinWheel()">SPIN</div>
        </div>
    </div>

    <!-- Cart Modal -->
    <div id="cartModal" class="cart-modal-overlay" onclick="closeCart(event)">
        <div class="cart-sidebar">
            <div class="cart-header">
                <h3>My Cart</h3>
                <button onclick="document.getElementById('cartModal').style.display='none'" style="background:none; border:none; font-size:18px; cursor:pointer;"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="cart-items-container" id="cartItemsContainer">
                <!-- Cart items injected via JS -->
                <div style="text-align:center; padding:30px; color:#888;">Your cart is empty</div>
            </div>
            <div class="cart-footer">
                <div class="cart-total-row">
                    <span>Total</span>
                    <span id="cartTotalDisplay">Rs. 0</span>
                </div>
                <button onclick="buyNow()" style="width:100%; padding:12px; background:var(--primary-orange); color:white; border:none; border-radius:5px; font-weight:bold; cursor:pointer;">CHECKOUT</button>
            </div>
        </div>
    </div>

    <main id="homeView" class="container fade-in">
        <div class="hero-banner">
            <div class="hero-content">
                <h1>Grand Opening Sale</h1>
                <p>Flat 20% Off on Electronics & Fashion</p>
                <div style="display:flex; gap:15px; justify-content:center;">
                    <button onclick="document.getElementById('productsSection').scrollIntoView({behavior: 'smooth'})">SHOP NOW</button>
                    <button onclick="showSurpriseMe()" style="background: transparent; color: white; border: 2px solid white; box-shadow:none;">SURPRISE ME!</button>
                </div>
            </div>
        </div>

        <div class="flash-sale-container">
            <div class="flash-header">
                <div class="flash-title">Flash Sale</div>
                <div class="timer-box">
                    <span>Ending in</span>
                    <div class="timer-block" id="timerH">02</div> :
                    <div class="timer-block" id="timerM">45</div> :
                    <div class="timer-block" id="timerS">12</div>
                </div>
                <button onclick="viewAllFlash()" style="border:1px solid var(--primary-orange); color:var(--primary-orange); background:white; padding:5px 15px; border-radius:4px; font-weight:bold;">SHOP ALL</button>
            </div>
            <div class="flash-grid" id="flashGrid">
                <!-- Flash items injected via JS -->
            </div>
        </div>

        <div class="categories">
            <div class="cat-item" onclick="filterCategory('Mart')"><div class="cat-icon"><i class="fa-solid fa-store"></i></div>Mart</div>
            <div class="cat-item" onclick="filterCategory('Fashion')"><div class="cat-icon"><i class="fa-solid fa-shirt"></i></div>Fashion</div>
            <div class="cat-item" onclick="filterCategory('Beauty')"><div class="cat-icon"><i class="fa-solid fa-spray-can"></i></div>Beauty</div>
            <div class="cat-item" onclick="filterCategory('Home')"><div class="cat-icon"><i class="fa-solid fa-house"></i></div>Home</div>
            <div class="cat-item" onclick="filterCategory('Electronics')"><div class="cat-icon"><i class="fa-solid fa-mobile-screen"></i></div>Devices</div>
        </div>

        <div style="display:flex; align-items:center; justify-content: space-between;">
            <h3 class="section-title" id="productsSection">Just For You</h3>
            <div id="sortControls" style="font-size:13px;">
                <label style="margin-right:6px; color:#666;">Sort:</label>
                <select onchange="handleSort(this.value)" style="padding:6px 8px; border-radius:6px; border:1px solid #ddd;">
                    <option value="popular">Popularity</option>
                    <option value="price_asc">Price: Low to High</option>
                    <option value="price_desc">Price: High to Low</option>
                    <option value="discount">Best Discount</option>
                </select>
            </div>
        </div>
        <div class="products-grid" id="productsGrid">
            </div>
            
        <div class="contact-section">
            <div class="contact-info">
                <h3>Customer Care</h3>
                <p style="margin-bottom:5px; color:#666;">We are here to help you 24/7</p>
                <div class="contact-email">sandeepadeneth12@gmail.com</div>
                <div style="margin-top:10px; font-size:14px; color:#888;">
                    <i class="fa-solid fa-location-dot" style="margin-right:5px;"></i> Colombo, Sri Lanka
                </div>
            </div>
            <div class="social-links" style="display:flex; gap:15px;">
                <button style="width:40px; height:40px; border-radius:50%; border:1px solid #ddd; background:white; color:#3b5998;"><i class="fa-brands fa-facebook-f"></i></button>
                <button style="width:40px; height:40px; border-radius:50%; border:1px solid #ddd; background:white; color:#E1306C;"><i class="fa-brands fa-instagram"></i></button>
                <button style="width:40px; height:40px; border-radius:50%; border:1px solid #ddd; background:white; color:#1DA1F2;"><i class="fa-brands fa-twitter"></i></button>
            </div>
        </div>
    </main>

    <main id="productDetailView" class="container">
        <div class="breadcrumb">
            <span onclick="goHome()">Home</span> &gt; <span id="detailBreadcrumbCategory">Category</span> &gt; <span id="detailBreadcrumbName">Product</span>
        </div>

        <div class="detail-container">
            <div class="detail-gallery">
                <img src="" alt="Product Detail" class="main-image" id="detailImage">
            </div>
            <div class="detail-info">
                <h1 class="detail-title" id="detailTitle">Product Title</h1>
                <div class="detail-rating">
                    <div class="stars">
                        <i class="fa-solid fa-star"></i>
                        <i class="fa-solid fa-star"></i>
                        <i class="fa-solid fa-star"></i>
                        <i class="fa-solid fa-star"></i>
                        <i class="fa-solid fa-star-half-stroke"></i>
                    </div>
                    <span id="detailReviews" style="color: #007185; margin-left: 5px;">(120 Ratings)</span>
                    <span style="margin: 0 10px; color: #ccc;">|</span>
                    <span style="color: #00bfa5;"><i class="fa-solid fa-check-circle"></i> Verified</span>
                </div>
                
                <div class="detail-price-box">
                    <div style="display:flex; align-items:baseline; gap:10px;">
                        <div class="detail-price" id="detailPrice">Rs. 0</div>
                        <div class="detail-discount" id="detailDiscount">-0%</div>
                    </div>
                    <div class="detail-old-price" id="detailOldPrice">Rs. 0</div>
                </div>

                <div>
                    <strong>Product Highlights:</strong>
                    <ul class="features-list" id="detailFeatures">
                        </ul>
                </div>

                <div class="detail-actions">
                    <button class="btn-buy" onclick="buyNow()">Buy Now</button>
                    <button class="btn-add" onclick="addToCart()">Add to Cart</button>
                </div>
                
                <div style="margin-top: 20px; font-size: 12px; color: #888; display:flex; gap:15px; border-top:1px solid #eee; padding-top:15px;">
                    <div><i class="fa-solid fa-shield-halved"></i> 100% Authentic</div>
                    <div><i class="fa-solid fa-rotate-left"></i> 14 Days Return</div>
                    <div><i class="fa-solid fa-truck-fast"></i> Fast Delivery</div>
                </div>
            </div>
            
            <div class="product-desc" style="width:100%;">
                <h3>Product Description</h3>
                <p id="detailDescription">Lorem ipsum dolor sit amet.</p>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px; margin-top:20px; background:#fafafa; padding:20px; border-radius:8px;">
                    <div>
                        <strong>Specifications</strong>
                        <ul style="font-size:13px; margin-top:10px; line-height:2; color:#555;">
                            <li>Brand: LankaMart Select</li>
                            <li>SKU: <span id="detailSku">12345</span></li>
                            <li>Warranty: 1 Year</li>
                        </ul>
                    </div>
                    <div>
                        <strong>Delivery Info</strong>
                        <ul style="font-size:13px; margin-top:10px; line-height:2; color:#555;">
                            <li>Standard Delivery: 2-3 Days</li>
                            <li>Express Delivery: 24 Hours</li>
                            <li>Cash on Delivery Available</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <h3 class="section-title">You Might Also Like</h3>
        <div class="products-grid" id="recommendationGrid">
            <!-- Recommendations injected via JS -->
        </div>
        <div style="margin-bottom: 50px;"></div>
    </main>

    <footer style="background: var(--secondary-blue); color: white; padding: 40px 0; margin-top: 50px;">
        <div class="container" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 30px;">
            <div>
                <h4 style="margin-bottom: 15px;">Customer Care</h4>
                <ul style="font-size: 13px; line-height: 2;">
                    <li>Help Center</li>
                    <li>How to Buy</li>
                    <li>Returns & Refunds</li>
                </ul>
            </div>
            <div>
                <h4 style="margin-bottom: 15px;">LankaMart</h4>
                <ul style="font-size: 13px; line-height: 2;">
                    <li>About Us</li>
                    <li>Digital Payments</li>
                    <li>Privacy Policy</li>
                </ul>
            </div>
            <div>
                <h4 style="margin-bottom: 15px;">Contact</h4>
                <p style="font-size: 13px;">Colombo, Sri Lanka</p>
                <p style="font-size: 13px;">sandeepadeneth12@gmail.com</p>
            </div>
        </div>
        <div style="text-align: center; margin-top: 30px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1); font-size: 12px;">
            &copy; 2026 LankaMart. All Rights Reserved.
        </div>
    </footer>

    <!-- CHECKOUT MODAL -->
    <div id="checkoutModal" class="modal-overlay">
        <div class="modal">
            <span class="modal-close" onclick="closeModal('checkoutModal')">&times;</span>
            <h2>Secure Checkout</h2>
            <div id="paymentForm">
                <div class="form-group">
                    <label>Card Number</label>
                    <div style="position:relative;">
                        <input type="text" class="form-control" placeholder="0000 0000 0000 0000" id="cardNum">
                        <i class="fa-brands fa-cc-visa" style="position:absolute; right:10px; top:12px; font-size:20px; color:#1a1f71;"></i>
                    </div>
                </div>
                <div style="display:flex; gap:15px;">
                    <div class="form-group" style="flex:1">
                        <label>Expiry Date</label>
                        <input type="text" class="form-control" placeholder="MM/YY">
                    </div>
                    <div class="form-group" style="flex:1">
                        <label>CVV</label>
                        <input type="text" class="form-control" placeholder="123">
                    </div>
                </div>
                <div class="form-group">
                    <label>Name on Card</label>
                    <input type="text" class="form-control" placeholder="John Doe">
                </div>
                <button class="btn-block" onclick="processPayment()">Pay Now</button>
                <div style="text-align:center; margin-top:15px; font-size:12px; color:#999;">
                    <i class="fa-solid fa-lock"></i> Secured by 256-bit SSL Encryption
                </div>
            </div>
            
            <div id="paymentSuccess" style="display:none; text-align:center;">
                <div style="width:80px; height:80px; background:#4CAF50; border-radius:50%; display:flex; align-items:center; justify-content:center; margin:0 auto 20px; color:white; font-size:40px;">
                    <i class="fa-solid fa-check"></i>
                </div>
                <h3 style="color:#4CAF50; margin-bottom:10px;">Payment Successful!</h3>
                <p style="color:#666; font-size:14px; margin-bottom:20px;">Your order has been placed successfully.</p>
                <p id="promoApplied" style="color:#333; font-size:14px; margin-bottom:10px; display:none;"></p>
                <button class="btn-block" onclick="closeModal('checkoutModal'); goHome();" style="background:#4CAF50;">Continue Shopping</button>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="modal-overlay">
        <div class="modal">
            <span class="modal-close" onclick="closeModal('loginModal')">&times;</span>
            <h2 id="loginTitle">Welcome to LankaMart!</h2>
            <div class="form-group">
                <label>Email or Phone Number</label>
                <input type="text" class="form-control" placeholder="Please enter your email">
            </div>
            <div class="form-group">
                <label>Password</label>
                <input type="password" class="form-control" placeholder="Please enter your password">
            </div>
            <button class="btn-block" onclick="loginUser()">Login</button>
            <div style="text-align:center; margin: 15px 0; color: #999; font-size: 13px;">Or continue with</div>
            <button class="google-btn" onclick="googleLogin()">
                <img src="https://upload.wikimedia.org/wikipedia/commons/5/53/Google_%22G%22_Logo.svg" width="20" alt="Google">
                Log in with Google
            </button>
            <div style="text-align:center; margin-top:15px; font-size:12px; color:#666;">
                New member? <a style="color:var(--primary-orange)" onclick="alert('Switching to Sign Up')">Register here</a>.
            </div>
        </div>
    </div>

    <script>
        // --- DATA ---
        const baseProducts = [
            { name: "Wireless Earbuds", cat: "Electronics", img: "https://images.unsplash.com/photo-1590658268037-6bf12165a8df?w=400" },
            { name: "Smart Watch", cat: "Electronics", img: "https://images.unsplash.com/photo-1523275335684-37898b6baf30?w=400" },
            { name: "Gaming Mouse", cat: "Electronics", img: "https://images.unsplash.com/photo-1527864550417-7fd91fc51a46?w=400" },
            { name: "Running Shoes", cat: "Fashion", img: "https://images.unsplash.com/photo-1542291026-7eec264c27ff?w=400" },
            { name: "Water Bottle", cat: "Sports", img: "https://images.unsplash.com/photo-1602143407151-0111419500be?w=400" },
            { name: "Face Cream", cat: "Beauty", img: "https://images.unsplash.com/photo-1611930022073-b7a4ba5fcccd?w=400" },
            { name: "Travel Backpack", cat: "Bags", img: "https://images.unsplash.com/photo-1553062407-98eeb64c6a62?w=400" },
            { name: "Bluetooth Speaker", cat: "Electronics", img: "https://images.unsplash.com/photo-1608043152269-423dbba4e7e1?w=400" },
            { name: "Sunglasses", cat: "Fashion", img: "https://images.unsplash.com/photo-1572635196237-14b3f281503f?w=400" },
            { name: "Coffee Maker", cat: "Home", img: "https://images.unsplash.com/photo-1517668808822-9ebb02f2a0e6?w=400" },
            { name: "Action Camera", cat: "Electronics", img: "https://images.unsplash.com/photo-1526170375885-4d8ecf77b99f?w=400" },
            { name: "Lipstick Set", cat: "Beauty", img: "https://images.unsplash.com/photo-1586495777744-4413f21062fa?w=400" },
            { name: "Desk Lamp", cat: "Home", img: "https://images.unsplash.com/photo-1507473888900-52e1adad5420?w=400" },
            { name: "Mechanical Keyboard", cat: "Electronics", img: "https://images.unsplash.com/photo-1587829741301-dc798b91a603?w=400" },
            { name: "Leather Wallet", cat: "Fashion", img: "https://images.unsplash.com/photo-1627123424574-183ce517a3ec?w=400" },
            { name: "Yoga Mat", cat: "Sports", img: "https://images.unsplash.com/photo-1592432678016-e910b452f9a2?w=400" },
            { name: "Perfume", cat: "Beauty", img: "https://images.unsplash.com/photo-1541643600914-78b084683601?w=400" },
            { name: "Gaming Headset", cat: "Electronics", img: "https://images.unsplash.com/photo-1618366712010-f4ae9c647dcb?w=400" },
            { name: "Sneakers", cat: "Fashion", img: "https://images.unsplash.com/photo-1560769629-975e127dfc17?w=400" },
            { name: "Plant Pot", cat: "Home", img: "https://images.unsplash.com/photo-1485955900006-10f4d324d411?w=400" },
            { name: "Smart Band", cat: "Electronics", img: "https://images.unsplash.com/photo-1575311373937-040b8e1fd5b6?w=400" },
            { name: "Denim Jacket", cat: "Fashion", img: "https://images.unsplash.com/photo-1576871337632-b9aef4c17ab9?w=400" },
            { name: "Dumbbell Set", cat: "Sports", img: "https://images.unsplash.com/photo-1638536532686-d610adfc8e5c?w=400" },
            { name: "Makeup Brush", cat: "Beauty", img: "https://images.unsplash.com/photo-1596462502278-27bfdd403348?w=400" },
            { name: "Laptop Stand", cat: "Electronics", img: "https://images.unsplash.com/photo-1588872657578-1a506d874535?w=400" },
            { name: "Graphic T-Shirt", cat: "Fashion", img: "https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?w=400" },
            { name: "Blender", cat: "Home", img: "https://images.unsplash.com/photo-1570222094114-28a9d8896aca?w=400" },
            { name: "Drone", cat: "Electronics", img: "https://images.unsplash.com/photo-1473968512647-3e447244af8f?w=400" },
            { name: "Handbag", cat: "Bags", img: "https://images.unsplash.com/photo-1584917865442-de89df76afd3?w=400" },
            { name: "Running Shorts", cat: "Sports", img: "https://images.unsplash.com/photo-1591195853828-11db59a44f6b?w=400" },
            { name: "Wall Clock", cat: "Home", img: "https://images.unsplash.com/photo-1563861826100-9cb868c72876?w=400" },
            { name: "Sun Hat", cat: "Fashion", img: "https://images.unsplash.com/photo-1533827432537-70133748f5c8?w=400" },
            { name: "VR Headset", cat: "Electronics", img: "https://images.unsplash.com/photo-1622979135225-d2ba269fb1bd?w=400" },
            { name: "Face Mask", cat: "Beauty", img: "https://images.unsplash.com/photo-1599305090598-fe179d501227?w=400" },
            { name: "Suitcase", cat: "Bags", img: "https://images.unsplash.com/photo-1565026057447-bc93a3d02d58?w=400" },
            { name: "Tennis Racket", cat: "Sports", img: "https://images.unsplash.com/photo-1622279457486-62dcc4a431d6?w=400" },
            { name: "Study Table", cat: "Home", img: "https://images.unsplash.com/photo-1519710164239-da123dc03ef4?w=400" },
            { name: "Hoodie", cat: "Fashion", img: "https://images.unsplash.com/photo-1556821840-3a63f95609a7?w=400" },
            { name: "Tablet", cat: "Electronics", img: "https://images.unsplash.com/photo-1544244015-0df4b3ffc6b0?w=400" },
            { name: "Hiking Boots", cat: "Fashion", img: "https://images.unsplash.com/photo-1520639888713-7851133b1ed0?w=400" },
            { name: "Yoga Ball", cat: "Sports", img: "https://images.unsplash.com/photo-1517931524326-bdd55a541177?w=400" },
            { name: "Hair Dryer", cat: "Beauty", img: "https://images.unsplash.com/photo-1522338140262-f46f5913618a?w=400" }
        ];

        const adjectives = ["Premium", "Durable", "Pro", "Ultra", "Classic", "Modern", "Sleek", "Portable", "Limited Edition", "Heavy Duty", "Luxury", "Compact", "Stylish"];
        const colors = ["Black", "White", "Blue", "Red", "Silver", "Gold", "Matte Finish", "Navy", "Rose Gold", "Space Grey"];

        let products = [];
        let flashItems = [];
        let cart = 0;
        let cartList = [];
        let visibleProducts = [];
        let activePromo = null;
        let currentProduct = null;

        function initData() {
            // Generate 150 items with more variety
            for (let i = 0; i < 150; i++) {
                // Completely random selection
                const baseIndex = Math.floor(Math.random() * baseProducts.length);
                const base = baseProducts[baseIndex];
                
                const adj = adjectives[Math.floor(Math.random() * adjectives.length)];
                const color = colors[Math.floor(Math.random() * colors.length)];
                
                const price = Math.floor(Math.random() * (45000 - 800) + 800);
                const discount = Math.floor(Math.random() * 50 + 5);
                
                products.push({
                    id: i,
                    title: `${adj} ${base.name} - ${color}`,
                    category: base.cat,
                    image: base.img,
                    price: price,
                    discount: discount,
                    oldPrice: Math.floor(price * (1 + discount/100)),
                    rating: (Math.random() * (5 - 3.5) + 3.5).toFixed(1),
                    reviews: Math.floor(Math.random() * 500 + 50),
                    description: `Experience the best of ${base.cat} with this ${adj} ${base.name}. Designed for those who appreciate quality and style. The ${color} finish adds a touch of elegance. Perfect for daily use.`,
                    sku: `LM-${10000 + i}`
                });
            }
            // Shuffle the products array to ensure grid is mixed
            products.sort(() => 0.5 - Math.random());
            
            // Render Skeletons first
            const grid = document.getElementById('productsGrid');
            grid.innerHTML = "";
            for(let k=0; k<8; k++) {
                grid.innerHTML += `
                <div class="skeleton-card">
                    <div class="skeleton skeleton-img"></div>
                    <div class="skeleton skeleton-text"></div>
                    <div class="skeleton skeleton-text short"></div>
                    <div class="skeleton skeleton-text short"></div>
                </div>`;
            }

            setTimeout(() => {
                renderProducts(products);
                renderFlashSale();
                startTimer();
                // Ensure wheel button is visible
                document.querySelector('.spin-btn-float').style.display = 'flex';
            }, 800); // Simulate network delay
        }

        // --- SURPRISE ME LOGIC ---
        function showSurpriseMe() {
            const surpriseItems = products
                .filter(p => p.discount > 25) // High discount
                .sort(() => 0.5 - Math.random()) // Randomize
                .slice(0, 5); // Pick 5
            
            // Update Section Title
            const sectionTitle = document.getElementById('productsSection');
            if(sectionTitle) sectionTitle.innerText = "ðŸŽ‰ Surprise Deals Just For You!";
            
            const grid = document.getElementById('productsGrid');
            grid.innerHTML = "";
            
            surpriseItems.forEach((p, index) => {
                const delay = index * 0.1;
                grid.innerHTML += createCardHtml(p).replace('class="card fade-in"', `class="card fade-in" style="animation-delay: ${delay}s"`);
            });
            
            if(sectionTitle) sectionTitle.scrollIntoView({behavior: 'smooth'});
            showToast("Surprise deals loaded!");
        }

        // --- RENDER LOGIC ---

        function createCardHtml(p, isFlash = false) {
            return `
                <div class="card fade-in" onclick="openProduct(${p.id})" style="${isFlash ? 'min-width:180px;' : ''}">
                    <div class="card-img-wrap">
                        <img src="${p.image}" class="card-img" alt="${p.title}" loading="lazy">
                        <div class="sale-badge">-${p.discount}%</div>
                        <div class="heart-btn" onclick="event.stopPropagation(); addToWishlist(${p.id})"><i class="fa-regular fa-heart"></i></div>
                    </div>
                    <div class="card-info">
                        <h4 class="card-title">${p.title}</h4>
                        <div class="card-price">Rs. ${p.price.toLocaleString()}</div>
                        <div style="margin-top:5px; font-size: 11px; color:#999;">
                            <span style="text-decoration:line-through">Rs. ${p.oldPrice.toLocaleString()}</span>
                            <span>-${p.discount}%</span>
                        </div>
                        <div class="rating-wrap">
                            <span class="stars"><i class="fa-solid fa-star"></i></span> ${p.rating} (${p.reviews})
                        </div>
                    </div>
                </div>
            `;
        }

        function renderProducts(list) {
            const grid = document.getElementById('productsGrid');
            grid.innerHTML = "";
            visibleProducts = [...list];
            if(list.length === 0) {
                grid.innerHTML = "<div style='grid-column: 1/-1; text-align:center; padding:50px; color:#777;'>No products found matching your search.</div>";
                return;
            }
            list.forEach((p, index) => {
                // Add staggered animation delay
                const delay = (index % 10) * 0.05;
                const card = createCardHtml(p);
                // Inject delay style
                const cardWithDelay = card.replace('class="card fade-in"', `class="card fade-in" style="animation-delay: ${delay}s"`);
                grid.innerHTML += cardWithDelay;
            });
        }

        function renderFlashSale() {
            const grid = document.getElementById('flashGrid');
            // Pick random 8 items for flash sale with high discount
            flashItems = [...products]
                .sort(() => 0.5 - Math.random())
                .slice(0, 8)
                .map(p => ({...p, discount: p.discount + 15, price: Math.floor(p.price * 0.85)}));
                
            grid.innerHTML = "";
            flashItems.forEach(p => {
                grid.innerHTML += createCardHtml(p, true);
            });
        }
        
        function viewAllFlash() {
            const sectionTitle = document.getElementById('productsSection');
            if(sectionTitle) sectionTitle.innerText = "Flash Sale: Top Deals";
            const items = [...products]
                .sort((a,b) => b.discount - a.discount)
                .slice(0, 12);
            renderProducts(items);
            if(sectionTitle) sectionTitle.scrollIntoView({behavior: 'smooth'});
        }

        function renderRecommendations(category, currentId) {
            const grid = document.getElementById('recommendationGrid');
            grid.innerHTML = "";
            
            // Filter by category, exclude current, take 6
            const recs = products
                .filter(p => p.category === category && p.id !== currentId)
                .sort(() => 0.5 - Math.random()) // Randomize recommendations
                .slice(0, 6);
            
            recs.forEach(p => {
                grid.innerHTML += createCardHtml(p);
            });
        }

        // --- NAVIGATION & INTERACTIVITY ---

        function goHome() {
            window.scrollTo(0, 0);
            document.getElementById('homeView').style.display = 'block';
            document.getElementById('homeView').style.opacity = '1';
            
            const detailView = document.getElementById('productDetailView');
            detailView.style.opacity = '0';
            setTimeout(() => { detailView.style.display = 'none'; }, 400);
        }

        function openProduct(id) {
            const p = products.find(x => x.id === id);
            if (!p) return;
            
            currentProduct = p;

            // Populate Details
            document.getElementById('detailImage').src = p.image;
            document.getElementById('detailTitle').innerText = p.title;
            document.getElementById('detailPrice').innerText = `Rs. ${p.price.toLocaleString()}`;
            document.getElementById('detailOldPrice').innerText = `Rs. ${p.oldPrice.toLocaleString()}`;
            document.getElementById('detailDiscount').innerText = `-${p.discount}%`;
            document.getElementById('detailBreadcrumbCategory').innerText = p.category;
            document.getElementById('detailBreadcrumbName').innerText = p.title.substring(0, 20) + "...";
            document.getElementById('detailReviews').innerText = `(${p.reviews} Ratings)`;
            document.getElementById('detailDescription').innerText = p.description;
            document.getElementById('detailSku').innerText = p.sku;

            // Update Buttons
            document.querySelector('.btn-buy').onclick = function() { addToCart(p.id); setTimeout(buyNow, 300); };
            document.querySelector('.btn-add').onclick = function() { addToCart(p.id); };

            // Generate Features List
            const features = [
                "Brand New & Sealed Box",
                `Color: ${p.title.split('-').pop()}`,
                "1 Year Company Warranty",
                "Express Shipping Available"
            ];
            const featureList = document.getElementById('detailFeatures');
            featureList.innerHTML = features.map(f => `<li><i class="fa-solid fa-check"></i> ${f}</li>`).join('');

            // Render Recommendations
            renderRecommendations(p.category, p.id);

            // Switch Views with Animation
            window.scrollTo(0, 0);
            const home = document.getElementById('homeView');
            const detail = document.getElementById('productDetailView');
            
            home.style.opacity = '0';
            setTimeout(() => {
                home.style.display = 'none';
                detail.style.display = 'block';
                // Trigger reflow
                void detail.offsetWidth;
                detail.style.opacity = '1';
            }, 400);
        }

        function handleSearch(e) {
            if (e.key === 'Enter') filterProducts();
        }

        function filterProducts() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            const filtered = products.filter(p => p.title.toLowerCase().includes(query) || p.category.toLowerCase().includes(query));
            
            const sectionTitle = document.getElementById('productsSection');
            if(sectionTitle && query && sectionTitle.innerText.indexOf('Category') === -1) {
                sectionTitle.innerText = `Search Results for "${query}"`;
            } else if (sectionTitle && !query) {
                sectionTitle.innerText = "Just For You";
            }
            
            if (document.getElementById('homeView').style.display === 'none') {
                goHome();
                setTimeout(() => {
                    renderProducts(filtered);
                    document.getElementById('productsSection').scrollIntoView({behavior: 'smooth'});
                }, 450);
            } else {
                renderProducts(filtered);
                document.getElementById('productsSection').scrollIntoView({behavior: 'smooth'});
            }
        }
        
        function handleSort(val) {
            let sorted = [...visibleProducts];
            if(val === 'price_asc') sorted.sort((a,b) => a.price - b.price);
            else if(val === 'price_desc') sorted.sort((a,b) => b.price - a.price);
            else if(val === 'discount') sorted.sort((a,b) => b.discount - a.discount);
            else sorted.sort((a,b) => b.reviews - a.reviews);
            renderProducts(sorted);
        }

        function filterCategory(cat) {
            const sectionTitle = document.getElementById('productsSection');
            
            if(cat === 'Mart' || cat === 'All') {
                document.getElementById('searchInput').value = '';
                if(sectionTitle) sectionTitle.innerText = "Just For You";
                renderProducts(products);
                if(sectionTitle) sectionTitle.scrollIntoView({behavior: 'smooth'});
                return;
            }
            
            document.getElementById('searchInput').value = cat;
            if(sectionTitle) sectionTitle.innerText = `Category: ${cat}`;
            filterProducts();
        }

        // --- UI FUNCTIONS ---
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            const icon = document.querySelector('.fa-moon');
            if(isDark) {
                icon.classList.remove('fa-moon');
                icon.classList.add('fa-sun');
            } else {
                icon.classList.remove('fa-sun');
                icon.classList.add('fa-moon');
            }
        }

        // --- CART LOGIC ---
        function addToCart(id) {
            // Check flash items first to get best price
            let p = flashItems.find(x => x.id == id);
            
            if (!p) {
                // Fallback to regular products
                p = products.find(x => x.id == id);
            }
            
            if(p) {
                // Create a copy to ensure independent cart item
                cartList.push({...p});
                updateCartUI();
                showToast("Item added to your cart!");
                // Open cart sidebar to show feedback
                openCart();
            }
        }
        
        // Modify addToCart signature in onclicks to pass ID. 
        // Existing calls: onclick="addToCart(${p.id})"
        
        function updateCartUI() {
            cart = cartList.length;
            document.getElementById('cartCount').innerText = cart;
            
            const container = document.getElementById('cartItemsContainer');
            if(cart === 0) {
                container.innerHTML = '<div style="text-align:center; padding:30px; color:#888;">Your cart is empty</div>';
                document.getElementById('cartTotalDisplay').innerText = 'Rs. 0';
                return;
            }
            
            container.innerHTML = '';
            let total = 0;
            
            cartList.forEach((item, index) => {
                total += item.price; // Use current price (discounted)
                // But wait, item.price in object is the selling price? 
                // In initData: price is random. oldPrice is higher. So price IS the selling price.
                
                container.innerHTML += `
                <div class="cart-item-row">
                    <img src="${item.image}" class="cart-item-img">
                    <div class="cart-item-info">
                        <div class="cart-item-title">${item.title}</div>
                        <div style="font-weight:bold; color:var(--primary-orange);">Rs. ${item.price.toLocaleString()}</div>
                    </div>
                    <button onclick="removeFromCart(${index})" style="background:none; border:none; color:#999; cursor:pointer;"><i class="fa-solid fa-trash"></i></button>
                </div>
                `;
            });
            
            document.getElementById('cartTotalDisplay').innerText = 'Rs. ' + total.toLocaleString();
        }
        
        function removeFromCart(index) {
            cartList.splice(index, 1);
            updateCartUI();
        }
        
        function openCart() {
            document.getElementById('cartModal').style.display = 'flex';
        }
        
        function closeCart(e) {
            if(e.target.id === 'cartModal') {
                document.getElementById('cartModal').style.display = 'none';
            }
        }

        // --- SPIN WHEEL LOGIC ---
        function openWheel() {
            document.getElementById('wheelModal').style.display = 'flex';
            drawWheel();
        }

        function closeWheel(e) {
            if(e.target.id === 'wheelModal') {
                document.getElementById('wheelModal').style.display = 'none';
            }
        }

        const segments = ["10% OFF", "Try Again", "Free Ship", "5% OFF", "Rs.500 OFF", "No Luck", "20% OFF", "Jackpot"];
        const colorsWheel = ["#FF5722", "#FF9800", "#FFC107", "#FFEB3B", "#8BC34A", "#00BCD4", "#3F51B5", "#9C27B0"];

        function drawWheel() {
            const wheel = document.getElementById('wheel');
            // Remove old labels
            const oldLabels = wheel.querySelectorAll('.wheel-label');
            oldLabels.forEach(e => e.remove());
            
            // Set conic gradient
            let gradientStr = "";
            segments.forEach((seg, i) => {
                const start = i * 45;
                const end = (i + 1) * 45;
                gradientStr += `${colorsWheel[i]} ${start}deg ${end}deg, `;
            });
            gradientStr = gradientStr.slice(0, -2); // remove last comma
            wheel.style.background = `conic-gradient(${gradientStr})`;
            
            // Add labels
            segments.forEach((seg, i) => {
                const label = document.createElement('div');
                label.className = 'wheel-label';
                // Rotate to center of segment: i*45 + 22.5
                label.style.transform = `translate(-50%, -50%) rotate(${i * 45 + 22.5}deg)`;
                label.innerText = seg;
                wheel.appendChild(label);
            });
        }

        let spinning = false;
        function spinWheel() {
            if(spinning) return;
            spinning = true;
            const wheel = document.getElementById('wheel');
            
            // Determine target
            const targetIndex = Math.floor(Math.random() * segments.length);
            
            // Calculate rotation
            // We want the target segment to land at the TOP (pointer is at top? No, pointer css is top: -15px).
            // Pointer is at 0 degrees (12 o'clock).
            // Segment 0 spans 0-45 deg. Center is 22.5 deg.
            // If we want segment 0 to be at top, we rotate 360 - 22.5?
            // Wait, rotation rotates the whole wheel clockwise.
            // To bring 22.5 (center of seg 0) to 0 (top), we rotate -22.5 (or 337.5).
            
            const segmentCenter = targetIndex * 45 + 22.5;
            // We want this angle to end up at 0 (top).
            // So we need to rotate by (360 - segmentCenter).
            // Add extra spins (360 * 5)
            
            let finalRotation = (360 - segmentCenter) + (360 * 8); 
            
            // Add a little randomness within the segment (+- 15 deg) to make it realistic
            const randomOffset = Math.floor(Math.random() * 30) - 15; 
            // Wait, if we offset too much we might hit border.
            // Let's stick to center for now to ensure it points to correct text.
            
            wheel.style.transition = "transform 4s cubic-bezier(0.2, 0.8, 0.3, 1)";
            wheel.style.transform = `rotate(${finalRotation}deg)`;
            
            setTimeout(() => {
                spinning = false;
                const result = segments[targetIndex];
                let msg = "";
                if(result.includes("% OFF")) {
                    const val = parseInt(result);
                    activePromo = { type: 'percent', value: val };
                    msg = `You won ${val}% OFF! Applied to checkout.`;
                } else if(result.includes("Rs.500")) {
                    activePromo = { type: 'fixed', value: 500 };
                    msg = "You won Rs.500 OFF! Applied to checkout.";
                } else if(result === "Free Ship") {
                    activePromo = { type: 'shipping', value: 0 };
                    msg = "Free Shipping applied!";
                } else if(result === "Jackpot") {
                    activePromo = { type: 'percent', value: 25 };
                    msg = "Jackpot! Extra 25% OFF applied!";
                } else {
                    activePromo = null;
                    msg = "No discount this time. Try again!";
                }
                showToast(msg);
                
                // Keep the wheel there for a moment
                setTimeout(() => {
                     document.getElementById('wheelModal').style.display = 'none';
                     // Reset rotation for next time (optional, but looks better if we reset silently or keep it)
                     // If we reset, we need to remove transition
                     wheel.style.transition = "none";
                     wheel.style.transform = `rotate(${finalRotation % 360}deg)`;
                }, 2500);
            }, 4000);
        }

        // --- CHECKOUT & AUTH ---
        function buyNow() {
            if(cartList.length === 0) {
                showToast("Your cart is empty!");
                return;
            }
            document.getElementById('cartModal').style.display = 'none';
            document.getElementById('checkoutModal').style.display = 'flex';
            
            // Check for promo
            const promoText = document.getElementById('promoApplied');
            if(activePromo) {
                promoText.style.display = 'block';
                if(activePromo.type === 'percent') {
                    promoText.innerText = `Discount Applied: ${activePromo.value}% OFF`;
                } else if(activePromo.type === 'fixed') {
                    promoText.innerText = `Discount Applied: Rs. ${activePromo.value} OFF`;
                } else if(activePromo.type === 'shipping') {
                    promoText.innerText = `Discount Applied: Free Shipping`;
                }
            } else {
                promoText.style.display = 'none';
            }
        }

        function closeModal(id) {
            document.getElementById(id).style.display = 'none';
        }

        function processPayment() {
            const btn = document.querySelector('#paymentForm .btn-block');
            const originalText = btn.innerText;
            btn.innerText = "Processing...";
            btn.disabled = true;
            
            setTimeout(() => {
                document.getElementById('paymentForm').style.display = 'none';
                document.getElementById('paymentSuccess').style.display = 'block';
                
                // Clear cart
                cartList = [];
                updateCartUI();
                activePromo = null; // Reset promo
                
                btn.innerText = originalText;
                btn.disabled = false;
            }, 2000);
        }
        
        function showLogin() {
            document.getElementById('loginModal').style.display = 'flex';
        }

        function loginUser() {
            const inputs = document.querySelectorAll('#loginModal input');
            if(inputs[0].value && inputs[1].value) {
                showToast(`Welcome back!`);
                closeModal('loginModal');
            } else {
                alert('Please enter dummy credentials');
            }
        }

        function googleLogin() {
            showToast("Logged in with Google!");
            closeModal('loginModal');
        }

        function showToast(msg) {
            const toast = document.getElementById('toast');
            toast.querySelector('span').innerText = msg;
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        function startTimer() {
            let h = 2, m = 45, s = 12;
            setInterval(() => {
                s--;
                if (s < 0) { s = 59; m--; }
                if (m < 0) { m = 59; h--; }
                if (h < 0) { h = 2; m = 45; } // Reset loop
                
                document.getElementById('timerH').innerText = h.toString().padStart(2, '0');
                document.getElementById('timerM').innerText = m.toString().padStart(2, '0');
                document.getElementById('timerS').innerText = s.toString().padStart(2, '0');
            }, 1000);
        }

        // Initialize
        initData();

        // Close modal on outside click
        window.onclick = function(event) {
            if (event.target.classList.contains('modal-overlay')) {
                event.target.style.display = "none";
            }
        }

    </script>
</body>
</html>
